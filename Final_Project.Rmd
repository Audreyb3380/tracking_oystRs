---
title: "Oyster Populations in Chesapeake Bay"
author: "tracking_oystRs"
date: "2023-12-05"
output: html_document
bibliography: BIOL3140.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(ggmap)
library(usmap)
library(ggplot2)
library(gridExtra)
library(car)
library(data.table)
library(MuMIn)
library(knitr)
library(kableExtra)
```

# Introduction
Eastern oysters (*Crassostrea virginica*) are a staple species of the Chesapeake Bay region, the area in the Mid-Atlantic United States separated by the Delmarva Peninsula (pictured below).

```{r regional map, echo=F, message=F,fig.dim=c(4,2)}
plot_usmap(include=c("DE","NJ","MD","VA","PA"))
```

Oysters are a staple of aquatic regions such as this one, due to their cultural value, their contribution to the economy, and their role in environmental regulation.

## The Cultural Significance of Oysters
Oysters have long played a crucial role in the cultural history of the Chesapeake Bay. According to a cultural model assessment conducted by Paolisso and Dery [@paolisso2010cultural], the restoration of oyster populations in the region is a topic of significant importance. The study explores various oyster restoration alternatives and provides insights into the cultural perspectives surrounding these efforts.  The cultural significance of oysters in the Chesapeake Bay extends beyond their ecological impact. Paolisso and Dery [@paolisso2010cultural] discuss how different restoration approaches are perceived within the local communities. Oysters are not merely a commodity; they are deeply embedded in the cultural fabric, shaping traditions and community practices. Understanding the cultural dimensions of oyster restoration is essential for developing sustainable and community-supported initiatives in the Chesapeake Bay region.

## Environmental Impacts
Chesapeake Bay oysters face considerable challenges due to climate change and environmental variables like pH, salinity, water temperature, and nitrogen. The Bay, highly vulnerable to climate change, experiences rising seas, ocean acidification, warming water temperatures, and prolonged extreme weather, disrupting water quality, habitat, and wildlife.  Oyster shell growth requires a sustained deposition of calcium carbonate, however, this is less available in acidic conditions leading to low calcification rates.  Daily fluctuations in salinity have also been harmful to these oysters.  They rely on freshwater input to survive, and parasites that infect oysters prosper in both high-salinity and warm environments. Too high or low salinity levels also lead to a decrease in immunity.  Additionally, higher temperatures have led to waters being unable to hold as much dissolved oxygen (hypoxia).  This condition has led to severe oyster mortality, reproductive failure, and high susceptibility to parasites and disease.  These daily fluctuations of oxygen and acid have been intensified through the introduction of nitrogen and carbon dioxide from polluted air and runoff. 

# Methods

# Results
```{r environment data, echo=F, message=F}
temp_data <- read_csv("water_temp_data.csv")
ph_data <- read_csv("ph_data.csv")
sal_data <- read_csv("salinity_data.csv")
nit_data <- read_csv("nitrogen_data.csv")
```

The data collected along the Choptank River varies depending on the location, but a few trends in oyster population across all locations can clearly be seen.

```{r oyster data, echo=F, message=F,fig.cap="Observed oyster units between 1989 and 2015 from six locations along the Chesapeake Choptank River"}
oys_data <- read_csv("oyster_data.csv")
ggplot(oys_data,aes(x=Year,y=oyster_units,color = location_name))+geom_point()
```
```{r by year oysters, echo=F, message=F}
by_year_oys <- read_csv("oys_sums_years.csv") 
ggplot(by_year_oys, aes(x=Year,y=sum_oyster_units))+geom_point()
```

```{r joining the data, echo=F, message=F,fig.cap="Average salinity, average pH, average water temperature, and temperature divergence from the average plotted against year"}
environ <- merge(x=sal_data,y=ph_data,by="Year",all.x=TRUE)%>%
  left_join(temp_data,by="Year")%>%
  left_join(nit_data,by="Year")
dat <- environ %>%
  left_join(by_year_oys,by="Year")

```

To make a prediction about the impact of each environmental factor, the average salinity, pH, nitrogen, water temperature, and divergence in water temperature from the average are plotted individually from 1989 to 2015. This yearly range was selected to align with the years with available oyster data.
```{r plotting joined data, echo=F, message=F}

plot1 <- ggplot(environ,aes(x=Year,y=salinity_Average))+geom_point()
plot2 <- ggplot(environ,aes(x=Year,y=ph_Average))+geom_point()
plot3 <- ggplot(environ,aes(x=Year,y=nitrogen_Average))+geom_point()
plot4 <- ggplot(environ,aes(x=Year,y=water_temp_Average))+geom_point()
plot5 <- ggplot(environ,aes(x=Year,y=water_temp_Divergence))+geom_point()

grid.arrange(plot1,plot2,plot3,plot4,plot5)
```
To determine which of these environmental factors influence oyster population values, the most complicated linear model is run through the `dregde()` function to determine the best-fitting nested models within that complex model.

```{r modeling with dredge, echo=F, message=F}
dat.lm <- lm(sum_oyster_units~salinity_Average*ph_Average*water_temp_Average*water_temp_Divergence,dat,na.action="na.fail")

dat.aic <- dredge(dat.lm)

dat.kb <- kable(dat.aic[1:4,],caption = "Fit values for nested models of the most complicated lm model")
kable_styling(dat.kb)
```

The table above ranks the nested models based on how well they fit the data, with the best-fitting model at the top. Based on this analysis, the best-fitting model to explain oyster population numbers only contains the divergence in average temperature from the average yearly temperature over this twenty-six-year period. To see if this relationship is statistically significant, an `anova()` test can be performed.

```{r best model, echo=F, message=F}
best.dat.lm <- lm(sum_oyster_units~(water_temp_Divergence),dat,na.action="na.fail")
best.dat.aic <- anova(best.dat.lm)
best.dat.kb <- kable(best.dat.aic[1:4],caption="Statistical test for best model, as determined by `dredge()`")
kable_styling(best.dat.kb)

```

Unfortunately, the `anova()` test of significance is inconclusive, as shown by the **NaN**. This is because there is one observation per divergence value, meaning that there are no residuals. 

To answer the second question, average total nitrogen and total oyster units per year were compared in individual plots to first see if any patterns emerge at first glance.

```{r nitrogen plots, echo=F, message=F,fig.cap="Average nitrogen content and oyster population plotted between 1989 and 2015"}
nitro.plot <- ggplot(dat,aes(x=Year,y=nitrogen_Average))+geom_point()
oys.plot <- ggplot(dat,aes(x=Year,y=sum_oyster_units))+geom_point()
grid.arrange(oys.plot,nitro.plot)
```

Looking at the initial patterns of the graph, barring a handful of outliers, it seems that the oyster population and the amount of nitrogen present in the water have an inverse relationship. Instances of this pattern can be seen between 1992 and 1994 and between 2003 and 2004, where some of the lowest oyster counts match with some of the highest nitrogen content. Now comes the big question: is this relationship statistically significant, or is this seemingly-related variance more likely due to chance?

```{r nitrogen model, echo=F, message=F}
nit.lm <- lm(nitrogen_Average~sum_oyster_units,dat,na.action="na.fail")

nit.an <- Anova(nit.lm)
nit.kb <- kable(nit.an[1:4],caption="Statistical test for model predicting nitrogen content based on oyster population")
kable_styling(nit.kb)
```

The `Anova()` test of the `nit.lm` model reveals a p-value of 0.252696, which above the 0.05 value of significance.

# Discussion

# Author Contributions
Audrey:

Conor:

Jessica:

Letacianna:

Susanne:

Notes:
calculate temperature anomaly (mean temperature by day)
  Water quality crisis per year from a mean or standard
Add nitrogen or chlorophyll (use interactions for things that correlate)
Response variables: which few you want to predict
  Mortality
  
Visualization - response variable over time
Delegate tasks

Planning:
What factor do we want to look at: young oysters, sexually mature oysters, or market ready oysters
